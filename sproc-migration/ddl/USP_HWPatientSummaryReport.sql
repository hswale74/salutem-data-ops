 CREATE procedure USP_HWPatientSummaryReport ( 	@AccountID INT, 	@FromDate DATETIME, 	@ToDate DATETIME , 	@EnrollmentStatusID INT = 99, 	@Search NVARCHAR(MAX) = '', 	@OrderBy nvarchar(50) = 'PatientFullName',  	@OrderDir varchar(4) = 'asc',  	@StartFrom int = 0,  	@PageSize int = 999999999 ) AS BEGIN 	--SELECT @ToDate = DATEADD(day,1,@ToDate); 	With PatientSummary AS	( 		SELECT   			P.Patient_ID, 			P.Patient_MRN, 			P.Patient_First_Name +' ' + P.Patient_Last_Name AS PatientFullName, 			P.Patient_DOB, 			P.ZipCode, 			I.InPatientLogId, 			I.EpisodeId, 			I.EnrollmentStatus, 			E.Discription AS EnrollmentStatusName, 			I.EnrollmentDate, 			I.AdmissionDate, 			I.DischargeDate, 			I.UnitNumber, 			I.FinNumber, 			I.DRG, 			D.DRGTitle, 			FHV.Activity_Start_Date AS HomeVisitDate, 			PH.Activity_Start_Date AS PharmacistDate 		FROM Mst_Patient P 		INNER JOIN Trn_InPatientLog I ON I.Patient_ID = P.Patient_ID 		INNER JOIN Mst_Enum E ON E.EnumValue = I.EnrollmentStatus AND E.EnumType='EnrollmentStatus' 		LEFT JOIN View_HWF_PatientFirstHomeVisitStatus FHV ON FHV.Patient_ID = P.Patient_ID AND FHV.InPatientLogId=I.InPatientLogId AND FHV.Activity_Start_Status = 3 		LEFT JOIN View_HWF_PharmacyConsultActivityStatus PH ON PH.Patient_ID = P.Patient_ID AND PH.InPatientLogId=I.InPatientLogId AND PH.Activity_Start_Status = 3 		LEFT JOIN Mst_DRG D ON D.ID = I.DRG 		WHERE P.Patient_Status = 1 AND P.Account_ID = @AccountID  			AND I.DischargeDate >= @fromDate AND I.DischargeDate <= @toDate  			AND (@EnrollmentStatusID=99 OR I.EnrollmentStatus = @EnrollmentStatusID) -- All Enrollment Status or Specific enrollment status 			AND (@Search = ''  					OR P.Patient_MRN like '%'+ @Search + '%'  					OR P.Patient_First_Name like '%'+ @Search + '%'  					OR P.Patient_Last_Name like '%'+ @Search + '%'  					OR (P.Patient_First_Name + ' '+ P.Patient_Last_Name) like '%'+ @Search + '%' 					OR (P.Patient_Last_Name+ ' '+ P.Patient_First_Name ) like '%'+ @Search + '%' 				)   	), 	OrderByResult AS (SELECT *, ROW_NUMBER() over (order BY  							case when @orderBy = 'PatientFullName' and @orderDir = 'asc' then PatientFullName end, 							case when @orderBy = 'PatientFullName' and @orderDir = 'desc' then PatientFullName end desc 		) AS RowNumber FROM PatientSummary  	)  	SELECT *, (Select Count(Patient_ID) FROM PatientSummary) TotalRows   	FROM OrderByResult  	WHERE OrderByResult.RowNumber BETWEEN (@StartFrom + 1) AND (@StartFrom  + @pageSize)  END  --EXEC USP_HWPatientSummaryReport 21,'23NOV2022','23Nov2022',99,''  