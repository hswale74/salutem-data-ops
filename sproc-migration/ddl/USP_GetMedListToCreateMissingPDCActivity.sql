 Create procedure USP_GetMedListToCreateMissingPDCActivity AS BEGIN  	CREATE TABLE #TempNDC ( 		NDC VARCHAR(50), 		Med_ID INT, 		Strength_ID INT 	);  	INSERT INTO #TempNDC (NDC, Med_ID, Strength_ID) SELECT Distinct NDC.NDC,NDC.Med_ID,NDC.Strength_ID  	FROM Mst_MedNDC NDC  	INNER JOIN TRN_UHCMedNDC_List UHC ON NDC.NDC =UHC.NDC 	INNER JOIN Mst_Medicine M ON M.Med_ID=NDC.Med_ID  	INNER JOIN Mst_Med_Strength S ON NDC.Strength_ID = S.ID;  	DECLARE @CurrentYear INT = YEAR(GETDATE())  	DECLARE @CurrentDate DATE = GETDATE() 	 	SELECT DISTINCT PE.Patient_ID,  		--PE.UploadedYear, PE.EnrollmentDate, FHV.HomeVisitDate, 		MD.Refill_Next_Date, 		MD.Med_ID, 		MD.Med_Strength_ID, 		MD.DaysSupply 	FROM Trn_Patient_Enrollment PE  	INNER JOIN View_FirstHomeVisitComplete FHV ON PE.Patient_ID = FHV.Patient_ID AND PE.Patient_Enroll_ID = FHV.Patient_Enroll_ID 	INNER JOIN Trn_Patient_Med_Dosage MD ON PE.Patient_ID = MD.Patient_ID  		AND MD.Refill_Next_Date > @CurrentDate AND Patient_Dosage_Prescribed_Status = 1   	INNER JOIN #TempNDC T ON T.Med_ID = MD.Med_ID AND T.Strength_ID = MD.Med_Strength_ID 	WHERE  (PE.UploadedYear = @CurrentYear OR YEAR(PE.EnrollmentDate) = @CurrentYear) AND PE.Patient_Enrollment_Status IN (1,9,10,11,12) 	ORDER BY Patient_ID, MD.Refill_Next_Date;  	DROP TABLE #TempNDC END  -- EXEC USP_GetMedListToCreateMissingPDCActivity