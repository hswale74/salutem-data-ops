 Create procedure USP_MHPatientActivityByPatientId (@userId INT, @patientId INT) AS BEGIN 	 	Select  		MA.Activity_ID,  		MA.Activity_Name, 		MA.ActivityType,  		MA.Activity_Description, 		TPA.Patient_Activity_ID, 		TPA.Patient_ID, 		TPA.Activity_Type_ID, 		MAT.Activity_Type_Name, 		Coalesce(TPA.Activity_Actual_End_Time, TPA.Activity_Actual_Start_Time, TPA.Activity_Start_Date ) AS Activity_Start_Date, 		TPA.Activity_Start_Time, 		TPA.Activity_Actual_Start_Time, 		TPA.Activity_Actual_End_Time, 		TPA.Activity_Assigned_To, 		MU.User_First_Name + ' ' + MU.User_Last_Name AS Activity_Assigned_To_Name, 		TPA.Activity_Note, 		Coalesce(TPA.Activity_Start_Status, 1) AS Activity_Start_Status, 		TPA.Activity_Delay_Note, 		TPA.Activity_Status, 		TPA.Activity_CretaedAt, 		TPA.Activity_CreatedBy, 		TPA.Activity_UpdatedAt, 		TPA.Activity_UpdatedBy, 		TPA.Patient_Enroll_ID, 		P.Patient_First_Name, 		P.Patient_Middle_Name, 		P.Patient_Last_Name, 		P.Account_Name, 		P.ZipCode, 		PAA.AttemptNumber AS AttemptNumber, 		TPA.LastCallOutcomeName, 		--CASE WHEN PA.ConsentToProgram=0 AND ActivityOutcomeName='Completed' AND MA.ActivityType='InitialAssessment' THEN 'Completed No Consent' ELSE ActivityOutcomeName END AS ActivityOutcomeName, 		CASE WHEN MA.ActivityType='InitialAssessment' OR MA.ActivityType='ProgressNote'OR MA.ActivityType='GroupNote'OR MA.ActivityType='ClinicalCareScreening' OR MA.ActivityType='InitialPsychosocialEvaluation' THEN MAE.Discription ELSE TPA.ActivityOutcomeName END AS ActivityOutcomeName, 		TPA.HasFlagForReview,-- For mind healthy flow 		TPA.ReviewNote,-- For mind healthy flow to check whether review has been done or not 		TPA.SpentTimeInMinutes, --duration in min spent on activity. 		TPA.IsSubmited, 		TPA.IsBillable, 		E.Discription AS NoteTypeName 		,TPA.DateOfService 		,PA.EncounterDate 		,PA.EncounterStartTime 		,PA.EncounterEndTime 	From Trn_Patient_Activity TPA  	INNER JOIN Mst_Activity MA ON MA.Activity_ID = TPA.Activity_ID 	INNER JOIN View_Mst_Patient P ON P.Patient_ID = TPA.Patient_ID 	INNER JOIN Mst_Activity_Type MAT ON MAT.Activity_Type_ID = TPA.Activity_Type_ID 	INNER JOIN View_PatientActivityAttempt PAA ON PAA.Patient_Activity_ID = TPA.Patient_Activity_ID 	LEFT JOIN Trn_Activity_Attempt TAA ON TPA.Patient_Activity_ID = TAA.Patient_Activity_ID AND TAA.AttemptNumber = PAA.AttemptNumber 	LEFT JOIN Mst_User MU ON MU.User_ID = TPA.Activity_Assigned_To 	LEFT JOIN TrnPatientAssessmentLog PA  ON PA.PatientActivityID = TPA.Patient_Activity_ID AND PA.PatientID = TPA.Patient_ID 	LEFT JOIN Mst_Enum E ON E.ID = PA.NoteType 	LEFT JOIN MstAssessmentEnum MAE ON PA.Attendance = MAE.EnumValue AND MAE.EnumType = 'Attendance' 	WHERE P.Patient_Status = 1 AND TPA.Patient_ID = @patientId AND TPA.Activity_Status = 1 END  -- EXEC USP_MHPatientActivityByPatientId 3, 23423