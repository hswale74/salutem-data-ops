 Create procedure USP_GetAssociatedActivitiesForMonth  ( 	@PatientID int = 0, 	@MonthOfService date, 	@ActivityType varchar(250) ) AS BEGIN 	SET NOCOUNT ON 	BEGIN 		 		SELECT  			Patient_Activity_ID PatientActivityID, 			CAST(DateOfService AS DATE) AS DateOfService, 			CASE WHEN A.ActivityType IN ('Call','EnrollmentStatusNote','SignatureAttestation') THEN Coalesce(TPA.Activity_Actual_End_Time,TPA.Activity_Actual_Start_Time,TPA.Activity_Start_Date) ELSE TPAL.EncounterDate END AS EncounterDate, 			CASE WHEN A.ActivityType = 'Call' THEN 'PatientCommunication' ELSE A.ActivityType END AS ActivityType, 			U.User_First_Name+' '+U.User_Last_Name AS ActivityAssignedToName, 			TPAL.Attendance 			FROM Trn_Patient_Activity TPA 			INNER JOIN Mst_Activity A ON TPA.Activity_ID = A.Activity_ID 			INNER JOIN Mst_User U ON TPA.Activity_Assigned_To = U.User_ID 			LEFT JOIN TrnPatientAssessmentLog TPAL ON TPA.Patient_Activity_ID = TPAL.PatientActivityID 		WHERE Patient_ID = @PatientID 		AND Month(TPA.DateOfService) = Month(CAST(@MonthOfService AS DATE))  		AND Activity_Start_Status = 3 AND IsSubmited =1 		AND TPA.Activity_Status = 1 --AND TPA.SpentTimeInMinutes > 0 		order by PatientActivityID desc 	END END --EXEC USP_GetAssociatedActivitiesForMonth 22310, '03/15/2023','ClinicalCareScreening'     