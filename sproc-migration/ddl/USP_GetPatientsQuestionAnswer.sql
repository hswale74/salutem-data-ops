 Create procedure USP_GetPatientsQuestionAnswer ( 	@PatientID int, 	@QuestionsFor int, 	@AssessmentID INT =	0, 	@PatientActivityID int = 0 ) AS BEGIN 	IF @PatientActivityID = 0  	BEGIN 		SELECT QM.QuestionID ,QM.QuestionType ,QM.QuestionText ,QM.QuestionFor ,QM.QuestonSubType 		,QO.ID OptionID, QO.OptionsFor, QO.OptionText, QO.OptionValue, QO.HasQuestionLink, QO.LinkQuestionIds 		,Coalesce(PQA.ID, 0) ID 		,Coalesce(PQA.PatientID, @PatientID) PatientID 		,Coalesce(PQA.AssessmentID, @AssessmentID) AssessmentID 		,PQA.AnswerText 		,(CASE WHEN QM.QuestionType = 6 OR QM.QuestionType = 7 -- When Question type is ShortAnswer or LongAnswer then it should be display text as it is saved in answer table. 			THEN PQA.AnswerText  			ELSE (SELECT OptionText FROM Mst_QuestionOptions MQO WHERE MQO.OptionValue = PQA.AnswerText AND MQO.OptionsFor = QM.QuestionFor)  			END) DisplayAnswerText, 		PQA.TypeText, 		PQA.QuantityText, 		PQA.FrequencyText, 		PQA.IsDeleted 	FROM Mst_Questions QM  	INNER JOIN Mst_QuestionOptions QO on QO.OptionsFor=QM.QuestionFor 		AND QO.OptionsFor = @QuestionsFor -- here OptionsFor is the same as @QuestionFor, Make sure that when adding new questions and options in master table, QuestionFor and OptionsFor should be the same. 	LEFT JOIN Trn_PatientQuestionAnswers PQA ON QM.QuestionID = PQA.QuestionID  AND PQA.IsDeleted = 0 		AND PQA.PatientID = @PatientID 		AND PQA.AssessmentID = @AssessmentID 	WHERE QM.QuestionFor = @QuestionsFor  	ORDER BY QM.QuestionID, QO.OptionValue 	END 	ELSE 	BEGIN 		SELECT QM.QuestionID ,QM.QuestionType ,QM.QuestionText ,QM.QuestionFor ,QM.QuestonSubType 		,QO.ID OptionID, QO.OptionsFor, QO.OptionText, QO.OptionValue, QO.HasQuestionLink, QO.LinkQuestionIds 		,Coalesce(PQA.ID, 0) ID 		,Coalesce(PQA.PatientID, @PatientID) PatientID 		,Coalesce(PQA.AssessmentID, @AssessmentID) AssessmentID 		,PQA.AnswerText 		,(CASE WHEN QM.QuestionType = 6 OR QM.QuestionType = 7 -- When Question type is ShortAnswer or LongAnswer then it should be display text as it is saved in answer table. 			THEN PQA.AnswerText  			ELSE (SELECT OptionText FROM Mst_QuestionOptions MQO WHERE MQO.OptionValue = PQA.AnswerText AND MQO.OptionsFor = QM.QuestionFor)  			END) DisplayAnswerText, 		PQA.TypeText, 		PQA.QuantityText, 		PQA.FrequencyText, 		PQA.IsDeleted 	FROM Mst_Questions QM  	INNER JOIN Mst_QuestionOptions QO on QO.OptionsFor=QM.QuestionFor 		AND QO.OptionsFor = @QuestionsFor -- here OptionsFor is the same as @QuestionFor, Make sure that when adding new questions and options in master table, QuestionFor and OptionsFor should be the same. 	LEFT JOIN Trn_PatientQuestionAnswersLog PQA ON QM.QuestionID = PQA.QuestionID  AND PQA.IsDeleted = 0 		AND PQA.PatientID = @PatientID 		AND PQA.AssessmentID = @AssessmentID 	AND PQA.PatientActivityID = @PatientActivityID 	WHERE QM.QuestionFor = @QuestionsFor  	ORDER BY QM.QuestionID, QO.OptionValue 	END END  -- EXEC USP_GetPatientsQuestionAnswer 3,1