 CREATE procedure [dbo].[USP_GetHomeVisitReportForHospital] ( 	@AccountId INT, 	@activityId int, 	@fromDate DATETIME, 	@toDate DATETIME, 	@pccId int, 	@status int, 	@HomeVisitType int, 	@orderBy nvarchar(50) = 'PatientFullName',  	@orderDir varchar(4) = 'asc',  	@StartFrom int = 0,  	@PageSize int = 999999999 ) AS BEGIN select @toDate= dateadd(dd,1,@toDate); 	With ActivityReportResult AS(SELECT  		patient.Patient_MRN, 		patient.Patient_ID, 		patient.Patient_First_Name +' '+ patient.Patient_Last_Name AS PatientFullName, 		patient.Patient_Contact_State, 		patient.CMS_Contract_Number, 		PA.Patient_Activity_ID, 		PA.Activity_ID, 		Coalesce(PA.Activity_Actual_End_Time, PA.Activity_Actual_Start_Time, PA.Activity_Start_Date ) AS Activity_Start_Date, 		PA.Activity_Start_Time, 		PA.Activity_Assigned_To, 		PA.SpentTimeInMinutes, 		U.User_First_Name + ' ' + U.User_Last_Name AS PCCFullName, 		Coalesce(PA.Activity_Start_Status, 1) AS Activity_Start_Status, 		ActivityOutcomeName, 		TIP.FinNumber, 		TIP.UnitNumber, 		patient.ZipCode, 		drg.DRGTitle, 		TIP.DischargeDate, 		PA.ActivityReasonDescription as ReasonforStatus, 		ME.EnumName, 		MAT.Activity_Type_Name 		FROM Trn_Patient_Activity PA 	INNER JOIN View_Mst_Patient patient ON PA.Patient_ID = patient.Patient_ID AND patient.Account_ID = @AccountId 	INNER JOIN Trn_InPatientLog TIP ON TIP.Patient_ID = patient.Patient_ID AND patient.Account_ID = @AccountID AND TIP.InPatientLogId = PA.InPatientLogId 	INNER JOIN Mst_Enum ME ON Coalesce(PA.Activity_Start_Status, 1) = ME.EnumValue AND ME.EnumType = 'ActivityStatus' 	 	LEFT JOIN Mst_User U ON U.User_ID = PA.Activity_Assigned_To 	LEFT JOIN Mst_DRG drg  ON drg.ID = TIP.DRG 	INNER JOIN dbo.Mst_Activity_Type MAT with (nolock)  ON MAT.Activity_Type_ID = PA.Activity_Type_ID 	WHERE PA.Activity_ID = @activityId  		AND( PA.Activity_UpdatedAt >= @fromDate AND PA.Activity_UpdatedAt <= @toDate) 		AND (@HomeVisitType = 0 OR PA.Activity_Type_ID = @HomeVisitType) 		AND (@pccId = 0 OR PA.Activity_Assigned_To = @pccId) 		AND (@status = 0 OR (Coalesce(PA.Activity_Start_Status, 1) = @status)) 	), 	OrderByResult AS (SELECT *, 			ROW_NUMBER() over ( 			order BY case when @orderBy = 'Activity_Start_Date' and @orderDir = 'asc' then Activity_Start_Date end, 								case when @orderBy = 'Activity_Start_Date' and @orderDir = 'desc' then Activity_Start_Date end desc, 								case when @orderBy = 'Patient_MRN' and @orderDir = 'asc' then Patient_MRN end, 								case when @orderBy = 'Patient_MRN' and @orderDir = 'desc' then Patient_MRN end desc, 								case when @orderBy = 'PatientFullName' and @orderDir = 'asc' then PatientFullName end, 								case when @orderBy = 'PatientFullName' and @orderDir = 'desc' then PatientFullName end desc, 								case when @orderBy = 'Patient_Contact_State' and @orderDir = 'asc' then Patient_Contact_State end, 								case when @orderBy = 'Patient_Contact_State' and @orderDir = 'desc' then Patient_Contact_State end desc, 								case when @orderBy = 'PCCFullName' and @orderDir = 'asc' then PCCFullName end, 								case when @orderBy = 'PCCFullName' and @orderDir = 'desc' then PCCFullName end desc, 								case when @orderBy = 'ActivityName' and @orderDir = 'asc' then Activity_Start_Status end, 								case when @orderBy = 'ActivityName' and @orderDir = 'desc' then Activity_Start_Status end desc 								 								 			) AS RowNumber FROM ActivityReportResult  	)   	SELECT *, (Select Count(Patient_ID) FROM ActivityReportResult) TotalRows   	FROM OrderByResult  	WHERE OrderByResult.RowNumber BETWEEN (@StartFrom + 1) AND (@StartFrom  + @pageSize) END  --EXEC USP_GetHomeVisitReportForHospita 7,3,'04/29/2021','07/31/2021',0,0,'PatientFullName','asc',0,10 