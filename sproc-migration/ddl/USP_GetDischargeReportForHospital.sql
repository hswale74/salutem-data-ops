 Create procedure [dbo].USP_GetDischargeReportForHospital ( 	@AccountID INT, 	@fromDate DATETIME, 	@toDate DATETIME, 	@ActivityStatusID INT, 	@orderBy nvarchar(50) = 'PatientFullName',  	@orderDir varchar(4) = 'asc',  	@StartFrom int = 0,  	@PageSize int = 999999999 ) AS BEGIN 	--select @toDate = dateadd(dd,1,@toDate); 	DECLARE @EnrollMstActivityID int; 	SET @EnrollMstActivityID = (SELECT Activity_ID FROM Mst_Activity WHERE ActivityType = 'EnrollPatient'); 	DECLARE @DischargeActivityID int; 	SET @DischargeActivityID = (SELECT Activity_ID FROM Mst_Activity WHERE ActivityType = 'DischargeInfo'); 	 	WITH Result AS ( 	SELECT  	        IPL.InPatientLogId, 			patient.Patient_ID,			 			patient.Patient_MRN, 			IPL.FinNumber,  			IPL.UnitNumber, 			patient.ZipCode, 			IPL.DRG, 			patient.Patient_First_Name + ' '+ patient.Patient_Last_Name  AS PatientFullName, 			IPL.DischargeDate, 			IPL.EnrollmentStatus, 			enm.Discription AS DisplayEnrollmentStatus, 			TPA.Activity_Assigned_To, 			usr.User_First_Name + ' ' + usr.User_Last_Name AS ActivityAssignedToName			 		FROM Trn_InPatientLog IPL with (nolock) 		INNER JOIN dbo.Mst_Patient patient with (nolock) ON patient.Patient_ID = IPL.Patient_ID AND patient.Account_ID = @AccountId		 		INNER JOIN Mst_Enum enm ON enm.EnumValue = IPL.EnrollmentStatus AND enm.EnumType = 'EnrollmentStatus' 		INNER JOIN Trn_Patient_Activity TPA ON TPA.Patient_ID = IPL.Patient_ID AND TPA.InPatientLogId = IPL.InPatientLogId AND (TPA.Activity_ID = @DischargeActivityID OR TPA.Activity_ID = @EnrollMstActivityID) 		LEFT JOIN Mst_User usr with (nolock) ON usr.User_ID = TPA.Activity_Assigned_To		 		WHERE IPL.DischargeDate >= @fromDate AND IPL.DischargeDate <= @toDate  		AND (@ActivityStatusID = 99 OR IPL.EnrollmentStatus = @ActivityStatusID)   	),  	OrderByResult AS (SELECT *, 			ROW_NUMBER() over ( 			order BY  			case when @orderBy = 'PatientFullName' and @orderDir = 'asc' then PatientFullName end, 								case when @orderBy = 'PatientFullName' and @orderDir = 'desc' then PatientFullName end desc,	 								case when @orderBy = 'Patient_MRN' and @orderDir = 'asc' then Patient_MRN end, 								case when @orderBy = 'Patient_MRN' and @orderDir = 'desc' then Patient_MRN end desc,	 								case when @orderBy = 'UnitNumber' and @orderDir = 'asc' then UnitNumber end, 								case when @orderBy = 'UnitNumber' and @orderDir = 'desc' then UnitNumber end desc, 								case when @orderBy = 'DRG' and @orderDir = 'asc' then DRG end, 								case when @orderBy = 'DRG' and @orderDir = 'desc' then DRG end desc, 								case when @orderBy = 'DischargeDate' and @orderDir = 'asc' then DischargeDate end, 								case when @orderBy = 'DischargeDate' and @orderDir = 'desc' then DischargeDate end desc,							 								case when @orderBy = 'EnrollmentStatus' and @orderDir = 'asc' then EnrollmentStatus end, 								case when @orderBy = 'EnrollmentStatus' and @orderDir = 'desc' then EnrollmentStatus end desc 								 			) AS RowNumber FROM Result  	)   	SELECT *, (Select Count(InPatientLogId) FROM Result) TotalRows   	FROM OrderByResult  	WHERE OrderByResult.RowNumber BETWEEN (@StartFrom + 1) AND (@StartFrom  + @pageSize); END  -- EXEC USP_GetDischargeReportForHospital 22,'01Oct2022','19Oct2022' -- EXEC sp_recompile N'dbo.USP_GetDischargeReportForHospital';   