Create Procedure USP_CLAIM_IMPORT (@FilePath NVarchar(Max)) As Begin Truncate Table SALUTEM_TEMP.DBO.CLAIM_IMPORT; Declare @SQL NVARCHAR(Max) = '' Set @SQL = N'     BULK INSERT Salutem_Temp.DBO.Claim_Import       FROM ''' + @filePath + '''       WITH ( 		FIRSTROW = 2, 		FORMAT = ''csv'',         FIELDTERMINATOR = '','',         ROWTERMINATOR = ''0x0a'', 		TABLOCK       )' Exec SP_EXECUTESQL @SQL; Select Count(*) As ROWSCOUNT From SALUTEM_TEMP.DBO.CLAIM_IMPORT End  --EXEC USP_Claim_Import 'C:\Working\IPEP\Upload\c3_claims_20210407.csv' --EXEC USP_Claim_Import 'C:\Working\IPEP\Upload\c3_claims_20210405-Sample.csv'  ----Query for getting new claim record  --SELECT CI.* FROM Salutem_Temp.DBO.Claim_Import CI INNER JOIN Mst_Patient P ON CI.MBI=P.Patient_MRN AND P.Patient_Status=1 --LEFT JOIN Trn_Patient_Med_Dosage PMD ON P.Patient_ID = PMD.Patient_ID AND CI.service_date=PMD.ServiceDate AND CI.rx_number=PMD.RxNumber --WHERE PMD.Patient_ID IS NULL AND PMD.ServiceDate IS NULL and PMD.RxNumber IS NULL --ORDER BY MBI,NDC,rx_number,service_date
