 Create procedure USP_GetAttendanceReport  ( 	@AccountID INT, 	@ToMonth DATETIME ) AS BEGIN DECLARE @FromDate DATETIME = DATEADD(month, DATEDIFF(month, 0, @ToMonth), 0); DECLARE @ToDate DATETIME = DATEADD(d, -1, DATEADD(m, DATEDIFF(m, 0, @ToMonth) + 1, 0)); 	SET NOCOUNT ON 	SELECT 		P.PatientPracticeId 		,PR.PracticeName 		,AL.Attendance 		,AE.Discription AttendanceName 		,AL.AttendanceOption 		,CASE WHEN AL.Attendance = 3 THEN (SELECT Discription FROM MstAssessmentEnum WHERE EnumType = 'RescheduledByPatient' AND EnumValue = AL.AttendanceOption) 		WHEN AL.Attendance = 4 THEN (SELECT Discription FROM MstAssessmentEnum WHERE EnumType = 'RescheduledByMindHealthy' AND EnumValue = AL.AttendanceOption) 		WHEN AL.Attendance = 5 THEN (SELECT Discription FROM MstAssessmentEnum WHERE EnumType = 'Cancelled' AND EnumValue = AL.AttendanceOption) 		WHEN AL.Attendance = 6 THEN (SELECT Discription FROM MstAssessmentEnum WHERE EnumType = 'IncompleteAssessment' AND EnumValue = AL.AttendanceOption) 		ELSE '' END AS AttendanceOptionName 		,AL.AttendanceOptionReason 		,CASE WHEN AL.Attendance = 5 AND AL.AttendanceOption != ''AND AL.AttendanceOption = 1 THEN (SELECT Discription FROM MstAssessmentEnum WHERE EnumType = 'CancelledByMindHealthy' AND EnumValue = AL.AttendanceOptionReason) 		WHEN AL.Attendance = 5 AND AL.AttendanceOption != ''AND AL.AttendanceOption = 2 THEN (SELECT Discription FROM MstAssessmentEnum WHERE EnumType = 'CancelledByPatient' AND EnumValue = AL.AttendanceOptionReason) 		ELSE '' END AS AttendanceOptionReasonName 		,Coalesce(TPA.Activity_Actual_End_Time,TPA.Activity_Actual_Start_Time,TPA.Activity_Start_Date) ActivityDate 		FROM TrnPatientAssessmentLog AL 		INNER JOIN Trn_Patient_Activity TPA ON AL.PatientActivityID = TPA.Patient_Activity_ID 		INNER JOIN Mst_Patient P ON AL.PatientID = P.Patient_ID 		INNER JOIN Mst_Practice PR ON P.PatientPracticeId = PR.ID 		INNER JOIN MstAssessmentEnum AE ON AL.Attendance = AE.EnumValue AND AE.EnumType = 'Attendance' 	WHERE P.Account_ID = @AccountID 	AND Coalesce(TPA.Activity_Actual_End_Time,TPA.Activity_Actual_Start_Time,TPA.Activity_Start_Date) >= @FromDate 	AND Coalesce(TPA.Activity_Actual_End_Time,TPA.Activity_Actual_Start_Time,TPA.Activity_Start_Date) <= @ToDate 	GROUP BY P.PatientPracticeId,PR.PracticeName,AL.Attendance,AL.AttendanceOption,AL.AttendanceOptionReason,AE.Discription 	,TPA.Activity_Actual_End_Time,TPA.Activity_Actual_Start_Time,TPA.Activity_Start_Date END  --EXEC USP_GetAttendanceReport 31,'03-18-2023'