 Create procedure [dbo].[USP_GetAllPatients_Hospital] ( 	@userId int, 	@AccountId INT, 	@search nvarchar(50) = '',  	@EnrollmentStatus int = 0, -- zero will indicate not enrolled, 99 will indicate all enrollment status 	@orderBy nvarchar(50) = 'Paitent_ID',  	@orderDir varchar(4) = 'asc',  	@pageIndex int = 0,  	@pageSize int = 99999 ) AS BEGIN 	SET NOCOUNT ON; 	Declare @isAdmin BIT; 	SET @isAdmin = dbo.func_IsUserAdmin(@userId);  	WITH Result AS ( 		SELECT  			patient.Patient_ID, 			patient.Account_ID, 			patient.Patient_First_Name, 			patient.Patient_Last_Name, 			patient.Patient_First_Name + ' '+ patient.Patient_Last_Name  AS PatientFullName, 			patient.Patient_DOB, 			patientContact.Patient_Contact_Phone, 			Coalesce(patient.Patient_Status, 0) Patient_Status, 			Coalesce(TPI.EnrollmentStatus,0) AS Patient_Enrollment_Status, 			patient.Patient_MRN, 			Patient_Gender 		FROM dbo.Mst_Patient patient with (nolock) 		 		LEFT JOIN  			dbo.Trn_Patient_Contact patientContact with (nolock) ON patient.Patient_ID = patientContact.Patient_ID AND patientContact.IsPrimary = 1  		LEFT JOIN 			dbo.Trn_InPatientLog TPI with (nolock) ON TPI.Patient_ID = patient.Patient_ID AND TPI.InPatientLogId = patient.InPatientLogId 		WHERE patient.Account_ID = @AccountId  AND ( (Patient_First_Name + ' ' + Patient_Last_Name)  LIKE '%' + @search + '%' 			OR Patient_MRN LIKE '%' + @search + '%' 			OR patientContact.Patient_Contact_Phone LIKE '%' + @search + '%')  			AND (@EnrollmentStatus = 99 OR ISNULL(TPI.EnrollmentStatus, 0) = @EnrollmentStatus) 			AND (@isAdmin = 1 OR patient.Patient_Status = 1) 	),  	OrderByResult AS (SELECT *, 			ROW_NUMBER() over ( 			order BY case when @orderBy = 'PatientFullName' and @orderDir = 'asc' then PatientFullName end, 								case when @orderBy = 'PatientFullName' and @orderDir = 'asc' then PatientFullName end desc, 					 								case when @orderBy = 'Patient_DOB' and @orderDir = 'asc' then Patient_DOB end, 								case when @orderBy = 'Patient_DOB' and @orderDir = 'desc' then Patient_DOB end desc, 								case when @orderBy = 'Patient_MRN' and @orderDir = 'asc' then Patient_MRN end, 								case when @orderBy = 'Patient_MRN' and @orderDir = 'desc' then Patient_MRN end desc,  								case when @orderBy = 'Patient_Enrollment_Status' and @orderDir = 'asc' then Patient_Enrollment_Status end, 								case when @orderBy = 'Patient_Enrollment_Status' and @orderDir = 'desc' then Patient_Enrollment_Status end desc,  								case when @orderBy = 'Patient_Contact_Phone' and @orderDir = 'asc' then Patient_Contact_Phone end, 								case when @orderBy = 'Patient_Contact_Phone' and @orderDir = 'desc' then Patient_Contact_Phone end desc 								 			) AS RowNumber FROM Result  	)   	SELECT *, (Select Count(Patient_ID) FROM Result) TotalRows   	FROM OrderByResult  	WHERE --OrderByResult.RowNumber BETWEEN ((@pageIndex * @pageSize) + 1) AND ((@pageIndex + 1) * @pageSize) 		OrderByResult.RowNumber BETWEEN (@pageIndex + 1) AND (@pageIndex  + @pageSize)  END