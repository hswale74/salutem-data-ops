 Create procedure [DBO].USP_GetPayorActivityReport ( 	@AccountId INT, 	@AssignTo INT, 	@FromDate Date, 	@ToDate Date,  	@search nvarchar(50) = '',  	@orderBy nvarchar(50) = 'PatientFullName',  	@orderDir varchar(4) = 'asc',  	@StartFrom int = 0,  	@PageSize int = 999999999 ) AS BEGIN 	SET NOCOUNT ON; 	SET @ToDate = DATEADD(Day,1,@ToDate); 	 With ActivityReportResult AS (  	 SELECT  		 P.Patient_ID, 		 P.Patient_First_Name+ ' '+P.Patient_Last_Name PatientFullName, 		 P.Patient_MRN 		,Coalesce(PA.Activity_Actual_End_Time, PA.Activity_Actual_Start_Time, PA.Activity_Start_Date ) AS ActivityDate 		,A.Activity_Name 		,E.Discription ActivityStatus 		,PA.ActivityOutcomeName 		,U.User_First_Name+' '+U.User_Last_Name AssignToName 		--,PA.AttemptNumber 	FROM Mst_Patient P 	INNER JOIN Trn_Patient_Activity PA ON P.Patient_ID = PA.Patient_ID 	INNER JOIN Mst_Activity A ON PA.Activity_ID = A.Activity_ID 	INNER JOIN Mst_Enum E ON ISNULL(PA.Activity_Start_Status,1) = E.EnumValue AND E.EnumType = 'ActivityStatus' 	LEFT JOIN Mst_User U ON PA.Activity_Assigned_To = U.User_ID 	WHERE P.Account_ID = @AccountId 	AND (@AssignTo = 0 OR PA.Activity_Assigned_To = @AssignTo) 	AND Coalesce(PA.Activity_Actual_End_Time, PA.Activity_Actual_Start_Time, PA.Activity_Start_Date ) >= @FromDate 	AND Coalesce(PA.Activity_Actual_End_Time, PA.Activity_Actual_Start_Time, PA.Activity_Start_Date ) < @ToDate 	--ORDER BY P.Patient_ID,ActivityDate ),  	OrderByResult AS (SELECT *, 			ROW_NUMBER() over ( 			order BY case when @orderBy = 'PatientFullName' and @orderDir = 'asc' then PatientFullName end, 					 case when @orderBy = 'PatientFullName' and @orderDir = 'desc' then PatientFullName end desc, 					 case when @orderBy = 'Patient_MRN' and @orderDir = 'asc' then Patient_MRN end, 					 case when @orderBy = 'Patient_MRN' and @orderDir = 'desc' then Patient_MRN end desc, 					 case when @orderBy = 'Activity_Name' and @orderDir = 'asc' then Activity_Name end, 					 case when @orderBy = 'Activity_Name' and @orderDir = 'desc' then Activity_Name end desc, 					 case when @orderBy = 'AssignToName' and @orderDir = 'asc' then AssignToName end, 					 case when @orderBy = 'AssignToName' and @orderDir = 'desc' then AssignToName end desc 			) AS RowNumber FROM ActivityReportResult  	) 	 	SELECT *, (Select Count(Patient_ID) FROM ActivityReportResult) TotalRows   	FROM OrderByResult  	WHERE OrderByResult.RowNumber BETWEEN (@StartFrom + 1) AND (@StartFrom  + @pageSize) END