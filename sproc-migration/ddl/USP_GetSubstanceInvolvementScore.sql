 Create PROCEDURE [dbo].[USP_GetSubstanceInvolvementScore] 	@PatientID INT, 	@AssessmentID INT, 	@PatientActivityID int = 0 AS BEGIN 	IF @PatientActivityID = 0  	BEGIN 		WITH TempSIScore AS ( 			SELECT 				MQ.SequenceNumber, 				MQ.QuestionText, 				MQ.ClassInfo, 				SUM(Cast(PQA.AnswerText as int)) As TotalSIScore 			FROM Mst_Questions MQ 			INNER JOIN Trn_PatientQuestionAnswers PQA ON PQA.QuestionID = MQ.QuestionID AND PQA.IsDeleted = 0 				AND MQ.QuestionFor = 5 				AND QuestonSubType >=7 AND QuestonSubType<=12 -- From Section 3 to Section 8 				AND PQA.AssessmentID=@AssessmentID and PatientID=@PatientID 			GROUP BY Mq.SequenceNumber, MQ.QuestionText, MQ.ClassInfo 		) 		SELECT SequenceNumber, QuestionText, ClassInfo, TotalSIScore,  		(CASE WHEN TotalSIScore <=3 THEN 'Low Risk'  		      WHEN TotalSIScore >=4 AND TotalSIScore <=26 then 'Moderate Risk' 			  WHEN TotalSIScore >=27 then 'High Risk'end )as RiskDetails 		FROM TempSIScore 		ORDER BY SequenceNumber 	END 	ELSE 	BEGIN 		WITH TempSIScore AS ( 			SELECT 				MQ.SequenceNumber, 				MQ.QuestionText, 				MQ.ClassInfo, 				SUM(Cast(PQA.AnswerText as int)) As TotalSIScore 			FROM Mst_Questions MQ 			LEFT JOIN Trn_PatientQuestionAnswersLog PQA ON PQA.QuestionID = MQ.QuestionID AND PQA.IsDeleted = 0 				AND PQA.AssessmentID=@AssessmentID and PatientID=@PatientID 				AND PQA.PatientActivityID = @PatientActivityID 			WHERE MQ.QuestionFor = 5 AND QuestonSubType >=7 AND QuestonSubType<=12 -- From Section 3 to Section 8 			GROUP BY Mq.SequenceNumber, MQ.QuestionText, MQ.ClassInfo 		) 		SELECT SequenceNumber, QuestionText, ClassInfo, TotalSIScore,  		(CASE WHEN TotalSIScore <=3 THEN 'Low Risk'  		      WHEN TotalSIScore >=4 AND TotalSIScore <=26 then 'Moderate Risk' 			  WHEN TotalSIScore >=27 then 'High Risk'end )as RiskDetails 		FROM TempSIScore 		ORDER BY SequenceNumber 	END END --EXEC USP_GetSubstanceInvolvementScore 25801, 1020, 4314