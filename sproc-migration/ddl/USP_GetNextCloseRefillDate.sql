 Create procedure USP_GetNextCloseRefillDate ( 	@PatientID INT, 	@ActivityDate DATETIME, 	@DaysBefore INT  ) AS  BEGIN 	SELECT TOP 1 Patient_Dosage_ID,Refill_Next_Date,DaysSupply 	FROM Trn_Patient_Med_Dosage WHERE Patient_ID=@PatientID  		AND Refill_Next_Date>=GETDATE() -- getting only future refill date medicines only 		AND Patient_Dosage_Prescribed_Status = 1 -- All Active medicines only 		AND Refill_Next_Date >=  @ActivityDate 		AND Refill_Next_Date <= DATEADD(D, @DaysBefore, @ActivityDate) 	ORDER BY Refill_Next_Date,DaysSupply END  --EXEC USP_GetNextCloseRefillDate '13Feb2023',10