--EXEC USP_GetDashboardReportMonthly 31,'02/01/2023','02/01/2023',0 Create procedure USP_GetDashboardReportMonthly  ( 	@AccountID int, 	@FromMonth DATETIME, 	@ToMonth DATETIME, 	@ReferralType int ) AS BEGIN 	SET NOCOUNT ON 	;With Result AS 	( 		SELECT * FROM 		( 			SELECT PSL.PatientStatusId 			,MPS.EnumStatusName StatusName 			--,PSL.PatientStatusDate 			,P.PatientPracticeId 			,PR.PracticeName 			,DATENAME(Month,PSL.PatientStatusDate) MONTH, YEAR(PSL.PatientStatusDate) YEAR 			FROM TrnPatientStatusLog PSL 			INNER JOIN MstPatientStatuses MPS ON PSL.PatientStatusId = MPS.StatusID 			INNER JOIN Mst_Patient P ON PSL.PatientID = P.Patient_ID AND P.Account_ID = @AccountID 			LEFT JOIN Mst_Practice PR ON P.PatientPracticeId = PR.ID 			WHERE FORMAT(PSL.PatientStatusDate,'yyyy-MM' ) >= FORMAT(@FromMonth,'yyyy-MM' ) AND FORMAT(PSL.PatientStatusDate,'yyyy-MM' ) <= FORMAT(@ToMonth,'yyyy-MM' ) 			AND (@ReferralType = 0 OR P.TypeOfReferral = @ReferralType) 			AND PR.PracticeStatus = 1 			GROUP BY P.PatientPracticeId,PSL.PatientStatusId, 			MPS.EnumStatusName, 			PSL.PatientStatusDate, 			P.PatientPracticeId 			,PR.PracticeName 			,P.Patient_First_Name, P.Patient_Last_Name 		) t 		PIVOT( 				COUNT(PatientStatusId) 				FOR StatusName IN ( 						[AttemptingToEnroll], 						[Enrolled], 						[EnrolledNotResponding], 						[Declined], 						[Graduated], 						[Ineligible], 						[UnableToReach], 						[NewReferral], 						[IntakePending], 						[RescheduleIntake], 						[CheckContactInformation] 			) 		) AS pivot_table 	) 	SELECT PatientPracticeId,PracticeName,MONTH,YEAR,MONTH+'-'+CONVERT(VARCHAR(10),YEAR) MonthYear,AttemptingToEnroll,Enrolled, 	EnrolledNotResponding,Declined,Graduated,Ineligible,UnableToReach,NewReferral,IntakePending, 	RescheduleIntake,CheckContactInformation, 	Total = isnull(AttemptingToEnroll,0) + isnull(Enrolled,0) + isnull(EnrolledNotResponding,0)+ isnull(Declined,0) + 	isnull(Graduated,0) + isnull(Ineligible,0) + isnull(UnableToReach,0)+ isnull(NewReferral,0) + 	isnull(IntakePending,0) + isnull(RescheduleIntake,0) + isnull(CheckContactInformation,0) 	FROM Result 	ORDER BY YEAR, MONTH DESC  	--SELECT PatientPracticeId,PracticeName,MONTH,YEAR,MonthYear,AttemptingToEnroll,Enrolled, 	--EnrolledNotResponding,Declined,Graduated,Ineligible,UnableToReach,NewReferral,IntakePending, 	--RescheduleIntake,CheckContactInformation,Total FROM MonthyDashboardList END  --CREATE TABLE MonthyDashboardList --	( --		PatientPracticeId int, --		PracticeName varchar(MAX), --		MONTH varchar(250), --		YEAR int, --		MonthYear varchar(MAX), --		AttemptingToEnroll int, --		Enrolled int, --		EnrolledNotResponding int, --		Declined int, --		Graduated int, --		Ineligible int, --		UnableToReach int, --		NewReferral int, --		IntakePending int, --		RescheduleIntake int, --		CheckContactInformation int, --		Total int --	) -- DROP TABLE MonthyDashboardList
